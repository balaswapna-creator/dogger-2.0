from django.contrib import admin
from .models import (
    Owner, Patient, MedicalRecord, Prescription, 
    Vaccination, LabTest, Payment, Appointment, 
    Inventory, User
)

@admin.register(Owner)
class OwnerAdmin(admin.ModelAdmin):
    list_display = ['name', 'phone', 'email', 'city', 'created_at']
    search_fields = ['name', 'phone', 'email', 'whatsapp_number']
    list_filter = ['city', 'created_at']
    ordering = ['-created_at']
    
    fieldsets = (
        ('Basic Information', {
            'fields': ('name', 'phone', 'email')
        }),
        ('Contact Details', {
            'fields': ('address', 'city', 'whatsapp_number')
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    readonly_fields = ['created_at', 'updated_at']

@admin.register(Patient)
class PatientAdmin(admin.ModelAdmin):
    list_display = ['pet_name', 'species', 'breed', 'owner', 'gender', 'date_of_birth']
    search_fields = ['pet_name', 'microchip_id', 'owner__name']
    list_filter = ['species', 'gender', 'breed']
    ordering = ['-created_at']
    
    fieldsets = (
        ('Pet Information', {
            'fields': ('pet_name', 'species', 'breed', 'gender', 'date_of_birth')
        }),
        ('Physical Details', {
            'fields': ('color', 'microchip_id', 'photo')
        }),
        ('Owner', {
            'fields': ('owner',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    readonly_fields = ['created_at', 'updated_at']

@admin.register(MedicalRecord)
class MedicalRecordAdmin(admin.ModelAdmin):
    list_display = ['patient', 'visit_date', 'visit_type', 'doctor']
    search_fields = ['patient__pet_name', 'diagnosis', 'chief_complaint']
    list_filter = ['visit_type', 'visit_date', 'doctor']
    ordering = ['-visit_date']
    
    fieldsets = (
        ('Visit Information', {
            'fields': ('patient', 'doctor', 'visit_date', 'visit_type')
        }),
        ('Medical Details', {
            'fields': ('chief_complaint', 'diagnosis', 'treatment_plan', 'notes')
        }),
        ('Vitals', {
            'fields': ('vitals',),
            'classes': ('collapse',)
        }),
        ('Timestamps', {
            'fields': ('created_at', 'updated_at'),
            'classes': ('collapse',)
        }),
    )
    
    readonly_fields = ['created_at', 'updated_at']

@admin.register(Prescription)
class PrescriptionAdmin(admin.ModelAdmin):
    list_display = ['medical_record', 'medication_name', 'dosage', 'frequency']
    search_fields = ['medication_name', 'medical_record__patient__pet_name']
    list_filter = ['frequency']
    ordering = ['-created_at']

@admin.register(Vaccination)
class VaccinationAdmin(admin.ModelAdmin):
    list_display = ['patient', 'vaccine_name', 'date_administered', 'next_due_date']
    search_fields = ['vaccine_name', 'patient__pet_name']
    list_filter = ['date_administered', 'next_due_date']
    ordering = ['-date_administered']

@admin.register(LabTest)
class LabTestAdmin(admin.ModelAdmin):
    list_display = ['medical_record', 'test_name', 'test_date', 'status']
    search_fields = ['test_name', 'medical_record__patient__pet_name']
    list_filter = ['status', 'test_date']
    ordering = ['-test_date']

@admin.register(Payment)
class PaymentAdmin(admin.ModelAdmin):
    list_display = ['patient', 'amount', 'payment_method', 'payment_date', 'status']
    search_fields = ['patient__pet_name', 'invoice_number']
    list_filter = ['status', 'payment_method', 'payment_date']
    ordering = ['-payment_date']

@admin.register(Appointment)
class AppointmentAdmin(admin.ModelAdmin):
    list_display = ['patient', 'appointment_date', 'appointment_type', 'status']
    search_fields = ['patient__pet_name', 'reason']
    list_filter = ['status', 'appointment_type', 'appointment_date']
    ordering = ['-appointment_date']

@admin.register(Inventory)
class InventoryAdmin(admin.ModelAdmin):
    list_display = ['item_name', 'category', 'quantity', 'unit_price', 'expiry_date']
    search_fields = ['item_name', 'description']
    list_filter = ['category', 'expiry_date']
    ordering = ['item_name']

# User admin is already registered by Django, but we can customize it if needed
# If you want custom User admin, you'll need to unregister the default first